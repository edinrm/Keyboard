(function($){"use strict";$.keyboard=function(el,options){var base=this,o;base.$el=$(el);base.el=el;base.$el.data("keyboard",base);base.init=function(){base.options=o=$.extend(true,{},$.keyboard.defaultOptions,options);base.shiftActive=base.altActive=base.metaActive=base.sets=base.capsLock=false;base.lastKeyset=[false,false,false];base.rows=["","-shift","-alt","-alt-shift"];base.acceptedKeys=[];base.mappedKeys={};$('<!--[if lte IE 8]><script>jQuery("body").addClass("oldie");</script><![endif]--><!--[if IE]>'+'<script>jQuery("body").addClass("ie");</script><![endif]-->').appendTo("body").remove();base.msie=$("body").hasClass("oldie");base.allie=$("body").hasClass("ie");base.inPlaceholder=base.$el.attr("placeholder")||"";base.watermark=typeof document.createElement("input").placeholder!=="undefined"&&base.inPlaceholder!=="";base.regex=$.keyboard.comboRegex;base.decimal=/^\./.test(o.display.dec)?true:false;base.repeatTime=1e3/(o.repeatRate||20);o.preventDoubleEventTime=o.preventDoubleEventTime||100;base.isOpen=false;base.temp=$('<input style="position:absolute;left:-9999em;top:-9999em;" type="text" value="testing">').appendTo("body").caret(3,3);base.checkCaret=o.lockInput||base.temp.hide().show().caret().start!==3?true:false;base.temp.remove();base.lastCaret={start:0,end:0};base.temp=["",0,0];$.each("initialized beforeVisible visible hidden canceled accepted beforeClose".split(" "),function(i,f){if($.isFunction(o[f])){base.$el.bind(f+".keyboard",o[f])}});if(o.alwaysOpen){o.stayOpen=true}$(document).bind("mousedown keyup touchstart checkkeyboard".split(" ").join(".keyboard "),function(e){if(base.opening){return}base.escClose(e);if(e.target&&$(e.target).hasClass("ui-keyboard-input")){var kb=$(e.target).data("keyboard");if(kb&&kb.options.openOn){kb.focusOn()}}});base.$el.addClass("ui-keyboard-input "+o.css.input).attr({"aria-haspopup":"true",role:"textbox"});if(base.$el.is(":disabled")&&!base.$el.hasClass("ui-keyboard-lockedinput")){base.$el.addClass("ui-keyboard-nokeyboard")}if(o.openOn){base.$el.bind(o.openOn+".keyboard",function(){base.focusOn()})}if(!base.watermark&&base.$el.val()===""&&base.inPlaceholder!==""&&base.$el.attr("placeholder")!==""){base.$el.addClass("ui-keyboard-placeholder").val(base.inPlaceholder)}base.$el.trigger("initialized.keyboard",[base,base.el]);if(o.alwaysOpen){base.reveal()}};base.setCurrent=function(){$(".ui-keyboard-has-focus").removeClass("ui-keyboard-has-focus");$(".ui-keyboard-input-current").removeClass("ui-keyboard-input-current");base.$el.addClass("ui-keyboard-input-current");base.$keyboard.addClass("ui-keyboard-has-focus");base.isCurrent(true);base.isOpen=true};base.isCurrent=function(set){var cur=$.keyboard.currentKeyboard||false;if(set){cur=$.keyboard.currentKeyboard=base.el}else if(set===false&&cur===base.el){cur=$.keyboard.currentKeyboard=""}return cur===base.el};base.isVisible=function(){if(typeof base.$keyboard==="undefined"){return false}return base.$keyboard.is(":visible")};base.focusOn=function(){if(o.usePreview&&base.$el.is(":visible")){base.lastCaret=base.$el.caret()}if(!base.isVisible()){clearTimeout(base.timer);base.reveal()}if(o.alwaysOpen){base.setCurrent()}};base.reveal=function(){base.opening=true;$(".ui-keyboard").not(".ui-keyboard-always-open").hide();if(base.$el.is(":disabled")&&!base.$el.hasClass("ui-keyboard-lockedinput")){base.$el.addClass("ui-keyboard-nokeyboard");return}else{base.$el.removeClass("ui-keyboard-nokeyboard")}if(o.openOn){base.$el.unbind(o.openOn+".keyboard")}if(typeof base.$keyboard==="undefined"){base.startup()}if(!base.watermark&&base.el.value===base.inPlaceholder){base.$el.removeClass("ui-keyboard-placeholder").val("")}base.originalContent=base.$el.val();base.$preview.val(base.originalContent);if(o.acceptValid){base.checkValid()}var p,s;base.position=o.position;base.position.of=base.position.of||base.$el.data("keyboardPosition")||base.$el;base.position.collision=base.position.collision||(o.usePreview?"fit fit":"flip flip");if(o.resetDefault){base.shiftActive=base.altActive=base.metaActive=false;base.showKeySet()}base.$keyboard.css({position:"absolute",left:0,top:0});base.$el.trigger("beforeVisible.keyboard",[base,base.el]);base.setCurrent();base.$keyboard.show();if(o.usePreview&&base.msie){if(typeof base.width==="undefined"){base.$preview.hide();base.width=Math.ceil(base.$keyboard.width());base.$preview.show()}base.$preview.width(base.width)}if($.ui.position){base.$keyboard.position(base.position)}if(o.initialFocus){base.$preview.focus()}base.checkDecimal();base.lineHeight=parseInt(base.$preview.css("lineHeight"),10)||parseInt(base.$preview.css("font-size"),10)+4;if(o.caretToEnd){s=base.originalContent.length;base.lastCaret={start:s,end:s}}if(base.allie){s=base.lastCaret.start||base.originalContent.length;p={start:s,end:s};if(!base.lastCaret){base.lastCaret=p}if(base.lastCaret.end===0&&base.lastCaret.start>0){base.lastCaret.end=base.lastCaret.start}if(base.lastCaret.start<0){base.lastCaret=p}}setTimeout(function(){base.opening=false;if(o.initialFocus){base.$preview.caret(base.lastCaret.start,base.lastCaret.end)}base.$el.trigger("visible.keyboard",[base,base.el])},10);return base};base.startup=function(){if($.isFunction(o.create)){base.$keyboard=o.create(base)}if(typeof base.$keyboard==="undefined"){base.$keyboard=base.buildKeyboard()}base.preview=base.$preview[0];base.$decBtn=base.$keyboard.find(".ui-keyboard-dec");base.wheel=$.isFunction($.fn.mousewheel);base.alwaysAllowed=[20,33,34,35,36,37,38,39,40,45,46];if(o.enterNavigation||base.el.tagName==="TEXTAREA"){base.alwaysAllowed.push(13)}base.bindKeyboard();if(o.appendLocally){base.$el.after(base.$keyboard)}else{base.$keyboard.appendTo("body")}base.bindKeys();$(window).bind("resize.keyboard",function(){if(base.isVisible()){base.$keyboard.position(base.position)}})};base.bindKeyboard=function(){base.$preview.unbind("keypress keyup keydown mouseup touchend ".split(" ").join(".keyboard ")).bind("keypress.keyboard",function(e){var k=base.lastKey=String.fromCharCode(e.charCode||e.which);base.$lastKey=[];if(base.checkCaret){base.lastCaret=base.$preview.caret()}base.capsLock=k>=65&&k<=90&&!e.shiftKey||k>=97&&k<=122&&e.shiftKey?true:false;if(o.restrictInput){if((e.which===8||e.which===0)&&$.inArray(e.keyCode,base.alwaysAllowed)){return}if($.inArray(k,base.acceptedKeys)===-1){e.preventDefault()}}else if((e.ctrlKey||e.metaKey)&&(e.which===97||e.which===99||e.which===118||e.which>=120&&e.which<=122)){return}if(base.hasMappedKeys){if(base.mappedKeys.hasOwnProperty(k)){base.lastKey=base.mappedKeys[k];base.insertText(base.lastKey);e.preventDefault()}}base.checkMaxLength()}).bind("keyup.keyboard",function(e){switch(e.which){case 9:if(base.tab&&o.tabNavigation&&!o.lockInput){base.shiftActive=e.shiftKey;var notSwitching=$.keyboard.keyaction.tab(base);base.tab=false;if(!notSwitching){return false}}else{e.preventDefault()}break;case 27:base.close();return false}clearTimeout(base.throttled);base.throttled=setTimeout(function(){if(base.isVisible()){base.checkCombos()}},100);base.checkMaxLength();if($.isFunction(o.change)){o.change($.Event("change"),base,base.el)}base.$el.trigger("change.keyboard",[base,base.el])}).bind("keydown.keyboard",function(e){switch(e.which){case 9:if(o.tabNavigation){base.tab=true;return false}else{base.tab=true;return false}break;case 13:$.keyboard.keyaction.enter(base,null,e);break;case 20:base.shiftActive=base.capsLock=!base.capsLock;base.showKeySet(this);break;case 86:if(e.ctrlKey||e.metaKey){if(o.preventPaste){e.preventDefault();return}base.checkCombos()}break}}).bind("mouseup.keyboard touchend.keyboard",function(){if(base.checkCaret){base.lastCaret=base.$preview.caret()}});base.$keyboard.bind("mousedown.keyboard click.keyboard touchstart.keyboard",function(e){e.stopPropagation();if(!base.isCurrent()){base.reveal();$(document).trigger("checkkeyboard.keyboard")}});if(o.preventPaste){base.$preview.bind("contextmenu.keyboard",function(e){e.preventDefault()});base.$el.bind("contextmenu.keyboard",function(e){e.preventDefault()})}};base.bindKeys=function(){var allEvents=(o.keyBinding+" repeater mouseenter mouseleave touchstart mousewheel "+"mouseup click ").split(" ").join(".keyboard ")+("mouseleave mousedown touchstart "+"touchend touchmove touchcancel ").split(" ").join(".kb ");base.$allKeys=base.$keyboard.find("button.ui-keyboard-button").unbind(allEvents).bind(o.keyBinding.split(" ").join(".keyboard ")+".keyboard repeater.keyboard",function(e){if(!base.$keyboard.is(":visible")){return false}var txt,key=$.data(this,"key"),action=key.action.split(":")[0],timer=(new Date).getTime();if(timer-(base.lastEventTime||0)<o.preventDoubleEventTime){return}base.lastEventTime=timer;base.$preview.focus();base.$lastKey=$(this);base.lastKey=key.curTxt;if(base.checkCaret){base.$preview.caret(base.lastCaret.start,base.lastCaret.end)}if(action.match("meta")){action="meta"}if($.keyboard.keyaction.hasOwnProperty(action)&&$(this).hasClass("ui-keyboard-actionkey")){if($.keyboard.keyaction[action](base,this,e)===false){return false}}else if(typeof key.action!=="undefined"){txt=base.lastKey=base.wheel&&!$(this).hasClass("ui-keyboard-actionkey")?key.curTxt:key.action;base.insertText(txt);if(!base.capsLock&&!o.stickyShift&&!e.shiftKey){base.shiftActive=false;base.showKeySet(this)}}base.$preview.focus().caret(base.lastCaret.start,base.lastCaret.end);base.checkCombos();base.checkMaxLength();if($.isFunction(o.change)){o.change($.Event("change"),base,base.el)}base.$el.trigger("change.keyboard",[base,base.el]);e.preventDefault()}).bind("mouseenter.keyboard mouseleave.keyboard touchstart.keyboard",function(e){if(!base.isCurrent()){return}var el=this,$this=$(this),key=$.data(el,"key"),txt=key.layers||base.getLayers($this);key.layers=txt=$.grep(txt,function(v,k){return $.inArray(v,txt)===k});if((e.type==="mouseenter"||e.type==="touchstart")&&base.el.type!=="password"&&!$this.hasClass(o.css.buttonDisabled)){$this.addClass(o.css.buttonHover).attr("title",function(i,t){return base.wheel&&t===""&&base.sets&&txt.length>1&&e.type!=="touchstart"?o.wheelMessage:t})}if(e.type==="mouseleave"){key.curTxt=key.original;key.curNum=0;$.data(el,"key",key);$this.removeClass(base.el.type==="password"?"":o.css.buttonHover).attr("title",function(i,t){return t===o.wheelMessage?"":t}).find("span").text(key.original)}}).bind("mousewheel.keyboard",function(e,delta){if(base.wheel){var txt,$this=$(this),key=$.data(this,"key");txt=key.layers||base.getLayers($this);if(txt.length>1){key.curNum+=delta>0?-1:1;if(key.curNum>txt.length-1){key.curNum=0}if(key.curNum<0){key.curNum=txt.length-1}}else{key.curNum=0}key.layers=txt;key.curTxt=txt[key.curNum];$.data(this,"key",key);$this.find("span").text(txt[key.curNum]);return false}}).bind("mouseup.keyboard mouseleave.kb touchend.kb touchmove.kb touchcancel.kb",function(e){if(/(mouseleave|touchend|touchcancel)/.test(e.type)){$(this).removeClass(o.css.buttonHover)}else{if(base.isVisible()&&base.isCurrent()){base.$preview.focus()}if(base.checkCaret){base.$preview.caret(base.lastCaret.start,base.lastCaret.end)}}base.mouseRepeat=[false,""];clearTimeout(base.repeater);return false}).bind("click.keyboard",function(){return false}).not(".ui-keyboard-actionkey").add(".ui-keyboard-tab, .ui-keyboard-bksp, .ui-keyboard-space, .ui-keyboard-enter",base.$keyboard).bind("mousedown.kb touchstart.kb",function(){if(o.repeatRate!==0){var key=$(this);base.mouseRepeat=[true,key];setTimeout(function(){if(base.mouseRepeat[0]&&base.mouseRepeat[1]===key){base.repeatKey(key)}},o.repeatDelay)}return false})};base.insertText=function(txt){var bksp,t,h,val=base.$preview.val(),pos=base.$preview.caret(),scrL=base.$preview.scrollLeft(),scrT=base.$preview.scrollTop(),len=val.length;if(pos.end<pos.start){pos.end=pos.start}if(pos.start>len){pos.end=pos.start=len}if(base.preview.tagName==="TEXTAREA"){if(base.msie&&val.substr(pos.start,1)==="\n"){pos.start+=1;pos.end+=1}h=val.split("\n").length-1;base.preview.scrollTop=h>0?base.lineHeight*h:scrT}bksp=txt==="bksp"&&pos.start===pos.end?true:false;txt=txt==="bksp"?"":txt;t=pos.start+(bksp?-1:txt.length);scrL+=parseInt(base.$preview.css("fontSize"),10)*(txt==="bksp"?-1:1);base.$preview.val(base.$preview.val().substr(0,pos.start-(bksp?1:0))+txt+base.$preview.val().substr(pos.end)).caret(t,t).scrollLeft(scrL);base.lastCaret={start:t,end:t}};base.checkMaxLength=function(){var t,p=base.$preview.val();if(o.maxLength!==false&&p.length>o.maxLength){t=Math.min(base.$preview.caret().start,o.maxLength);base.$preview.val(p.substring(0,o.maxLength));base.$preview.caret(t,t);base.lastCaret={start:t,end:t}}if(base.$decBtn.length){base.checkDecimal()}};base.repeatKey=function(key){key.trigger("repeater.keyboard");if(base.mouseRepeat[0]){base.repeater=setTimeout(function(){base.repeatKey(key)},base.repeatTime)}};base.showKeySet=function(el){var key="",toShow=(base.shiftActive?1:0)+(base.altActive?2:0);if(!base.shiftActive){base.capsLock=false}if(base.metaActive){key=el&&el.name&&/meta/.test(el.name)?el.name:"";if(key===""){key=base.metaActive===true?"":base.metaActive}else{base.metaActive=key}if(!o.stickyShift&&base.lastKeyset[2]!==base.metaActive||(base.shiftActive||base.altActive)&&!base.$keyboard.find(".ui-keyboard-keyset-"+key+base.rows[toShow]).length){base.shiftActive=base.altActive=false}}else if(!o.stickyShift&&base.lastKeyset[2]!==base.metaActive&&base.shiftActive){base.shiftActive=base.altActive=false}toShow=(base.shiftActive?1:0)+(base.altActive?2:0);key=toShow===0&&!base.metaActive?"-default":key===""?"":"-"+key;if(!base.$keyboard.find(".ui-keyboard-keyset"+key+base.rows[toShow]).length){base.shiftActive=base.lastKeyset[0];base.altActive=base.lastKeyset[1];base.metaActive=base.lastKeyset[2];return}base.$keyboard.find(".ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]").removeClass(o.css.buttonAction).end().find(".ui-keyboard-alt")[base.altActive?"addClass":"removeClass"](o.css.buttonAction).end().find(".ui-keyboard-shift")[base.shiftActive?"addClass":"removeClass"](o.css.buttonAction).end().find(".ui-keyboard-lock")[base.capsLock?"addClass":"removeClass"](o.css.buttonAction).end().find(".ui-keyboard-keyset").hide().end().find(".ui-keyboard-keyset"+key+base.rows[toShow]).show().end().find(".ui-keyboard-actionkey.ui-keyboard"+key).addClass(o.css.buttonAction);base.lastKeyset=[base.shiftActive,base.altActive,base.metaActive]};base.checkCombos=function(){if(!base.isVisible()){return base.$preview.val()}var i,r,t,t2,val=base.$preview.val(),pos=base.$preview.caret(),len=val.length;if(pos.end<pos.start){pos.end=pos.start}if(pos.start>len){pos.end=pos.start=len}if(base.msie&&val.substr(pos.start,1)==="\n"){pos.start+=1;pos.end+=1}if(o.useCombos){if(base.msie){val=val.replace(base.regex,function(s,accent,letter){return o.combos.hasOwnProperty(accent)?o.combos[accent][letter]||s:s})}else if(base.$preview.length){t=pos.start-(pos.start-2>=0?2:0);base.$preview.caret(t,pos.end);t2=(base.$preview.caret().text||"").replace(base.regex,function(s,accent,letter){return o.combos.hasOwnProperty(accent)?o.combos[accent][letter]||s:s});base.$preview.val(base.$preview.caret().replace(t2));val=base.$preview.val()}}if(o.restrictInput&&val!==""){t=val;r=base.acceptedKeys.length;for(i=0;i<r;i++){if(t===""){continue}t2=base.acceptedKeys[i];if(val.indexOf(t2)>=0){if(/[\[|\]|\\|\^|\$|\.|\||\?|\*|\+|\(|\)|\{|\}]/g.test(t2)){t2="\\"+t2}t=t.replace(new RegExp(t2,"g"),"")}}if(t!==""){val=val.replace(t,"")}}pos.start+=val.length-len;pos.end+=val.length-len;base.$preview.val(val);base.$preview.caret(pos.start,pos.end);base.preview.scrollTop=base.lineHeight*(val.substring(0,pos.start).split("\n").length-1);base.lastCaret={start:pos.start,end:pos.end};if(o.acceptValid){base.checkValid()}return val};base.checkValid=function(){var valid=true;if(o.validate&&typeof o.validate==="function"){valid=o.validate(base,base.$preview.val(),false)}base.$keyboard.find(".ui-keyboard-accept")[valid?"removeClass":"addClass"]("ui-keyboard-invalid-input")[valid?"addClass":"removeClass"]("ui-keyboard-valid-input")};base.checkDecimal=function(){if(base.decimal&&/\./g.test(base.preview.value)||!base.decimal&&/\,/g.test(base.preview.value)){base.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(o.css.buttonDefault+" "+o.css.buttonHover).addClass(o.css.buttonDisabled)}else{base.$decBtn.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass(o.css.buttonDefault).removeClass(o.css.buttonDisabled)}};base.getLayers=function(el){var key,keys;key=el.attr("data-pos");keys=el.closest(".ui-keyboard").find('button[data-pos="'+key+'"]').map(function(){return $(this).find("> span").text()}).get();return keys};base.switchInput=function(goToNext,isAccepted){if(typeof o.switchInput==="function"){o.switchInput(base,goToNext,isAccepted)}else{base.$keyboard.hide();var kb,stopped=false,all=$("button, input, textarea, a").filter(":visible"),indx=all.index(base.$el)+(goToNext?1:-1);base.$keyboard.show();if(indx>all.length-1){stopped=o.stopAtEnd;indx=0}if(indx<0){stopped=o.stopAtEnd;indx=all.length-1}if(!stopped){base.close(isAccepted);kb=all.eq(indx).data("keyboard");if(kb&&kb.options.openOn.length){kb.focusOn()}else{all.eq(indx).focus()}}}return false};base.close=function(accepted){if(base.isOpen){clearTimeout(base.throttled);var val=accepted?base.checkCombos():base.originalContent;if(accepted&&o.validate&&typeof o.validate==="function"&&!o.validate(base,val,true)){val=base.originalContent;accepted=false;if(o.cancelClose){return}}base.isCurrent(false);base.isOpen=false;base.$el.removeClass("ui-keyboard-input-current ui-keyboard-autoaccepted").addClass(accepted||false?accepted===true?"":"ui-keyboard-autoaccepted":"").trigger(o.alwaysOpen?"":"beforeClose.keyboard",[base,base.el,accepted||false]).val(val).scrollTop(base.el.scrollHeight).trigger(accepted||false?"accepted.keyboard":"canceled.keyboard",[base,base.el]).trigger(o.alwaysOpen?"inactive.keyboard":"hidden.keyboard",[base,base.el]).blur();base.$preview.val(val);if(o.openOn){base.timer=setTimeout(function(){base.$el.bind(o.openOn+".keyboard",function(){base.focusOn()});if($(":focus")[0]===base.el){base.$el.blur()}},500)}if(!o.alwaysOpen){base.$keyboard.hide()}if(!base.watermark&&base.el.value===""&&base.inPlaceholder!==""){base.$el.addClass("ui-keyboard-placeholder").val(base.inPlaceholder)}base.$el.trigger("change")}return!!accepted};base.accept=function(){return base.close(true)};base.escClose=function(e){if(e&&e.type==="keyup"){return e.which===27?base.close():""}if(!base.isOpen){return}if(!base.isCurrent()&&base.isOpen||base.isOpen&&e.target!==base.el&&!o.stayOpen){if(base.allie){e.preventDefault()}base.close(o.autoAccept?"true":false)}};base.keyBtn=$("<button />").attr({role:"button","aria-disabled":"false",tabindex:"-1"}).addClass("ui-keyboard-button");base.addKey=function(keyName,name,regKey){var t,keyType,m,map,nm,n=regKey===true?keyName:o.display[name]||keyName,kn=regKey===true?keyName.charCodeAt(0):keyName;if(/\(.+\)/.test(n)){map=n.replace(/\(([^()]+)\)/,"");m=n.match(/\(([^()]+)\)/)[1];n=map;nm=map.split(":");map=nm[0]!==""&&nm.length>1?nm[0]:map;base.mappedKeys[m]=map}nm=n.split(":");if(nm[0]===""&&nm[1]===""){n=":"}n=nm[0]!==""&&nm.length>1?$.trim(nm[0]):n;t=nm.length>1?$.trim(nm[1]).replace(/_/g," ")||"":"";keyType=n.length>1?" ui-keyboard-widekey":"";keyType+=regKey?"":" ui-keyboard-actionkey";return base.keyBtn.clone().attr({"data-value":n,name:kn,"data-pos":base.temp[1]+","+base.temp[2],title:t}).data("key",{action:keyName,original:n,curTxt:n,curNum:0}).addClass("ui-keyboard-"+kn+keyType+" "+o.css.buttonDefault).html("<span>"+n+"</span>").appendTo(base.temp[0])};base.buildKeyboard=function(){var t,action,row,newSet,isAction,currentSet,key,keys,margin,sets=0,container=$("<div />").addClass("ui-keyboard "+o.css.container+(o.alwaysOpen?" ui-keyboard-always-open":"")).attr({role:"textbox"}).hide();if(o.usePreview){base.$preview=base.$el.clone(false).removeAttr("id").removeClass("ui-keyboard-placeholder ui-keyboard-input").addClass("ui-keyboard-preview "+o.css.input).attr("tabindex","-1").show();$("<div />").addClass("ui-keyboard-preview-wrapper").append(base.$preview).appendTo(container)}else{base.$preview=base.$el;o.position.at=o.position.at2}if(o.lockInput){base.$preview.addClass("ui-keyboard-lockedinput").attr({readonly:"readonly"})}if(o.layout==="custom"||!$.keyboard.layouts.hasOwnProperty(o.layout)){o.layout="custom";$.keyboard.layouts.custom=o.customLayout||{"default":["{cancel}"]}}$.each($.keyboard.layouts[o.layout],function(set,keySet){if(set!==""){sets++;newSet=$("<div />").attr("name",set).addClass("ui-keyboard-keyset ui-keyboard-keyset-"+set).appendTo(container)[set==="default"?"show":"hide"]();for(row=0;row<keySet.length;row++){currentSet=$.trim(keySet[row]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");keys=currentSet.split(/\s+/);for(key=0;key<keys.length;key++){base.temp=[newSet,row,key];isAction=false;if(keys[key].length===0){continue}if(/^\{\S+\}$/.test(keys[key])){action=keys[key].match(/^\{(\S+)\}$/)[1].toLowerCase();if(/\!\!/.test(action)){action=action.replace("!!","");isAction=true}if(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/.test(action)){margin=parseFloat(action.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/)[1]||0);$("<span>&nbsp;</span>").width(action.match("px")?margin+"px":margin*2+"em").addClass("ui-keyboard-button ui-keyboard-spacer").appendTo(newSet)}if(/^meta\d+\:?(\w+)?/.test(action)){base.addKey(action,action);continue}switch(action){case"a":case"accept":base.addKey("accept",action).addClass(o.css.buttonAction);break;case"alt":case"altgr":base.addKey("alt","alt");break;case"b":case"bksp":base.addKey("bksp",action);break;case"c":case"cancel":base.addKey("cancel",action).addClass(o.css.buttonAction);break;case"combo":base.addKey("combo","combo").addClass(o.css.buttonAction);break;case"dec":base.acceptedKeys.push(base.decimal?".":",");base.addKey("dec","dec");break;case"e":case"enter":base.addKey("enter",action).addClass(o.css.buttonAction);break;case"empty":base.addKey(""," ").addClass(o.css.buttonDisabled).attr("aria-disabled",true);break;case"s":case"shift":base.addKey("shift",action);break;case"sign":base.acceptedKeys.push("-");base.addKey("sign","sign");break;case"space":base.acceptedKeys.push(" ");base.addKey("space","space");break;case"t":case"tab":base.addKey("tab",action);break;default:if($.keyboard.keyaction.hasOwnProperty(action)){base.addKey(action,action)[isAction?"addClass":"removeClass"](o.css.buttonAction)}}}else{t=keys[key];base.acceptedKeys.push(t===":"?t:t.split(":")[0]);base.addKey(t,t,true)}}newSet.find(".ui-keyboard-button:last").after('<br class="ui-keyboard-button-endrow">')}}});if(sets>1){base.sets=true}base.hasMappedKeys=!$.isEmptyObject(base.mappedKeys);return container};base.destroy=function(){$(document).unbind("mousedown.keyboard keyup.keyboard touchstart.keyboard");if(base.$keyboard){base.$keyboard.remove()}var unb=$.trim(o.openOn+" accepted beforeClose canceled change contextmenu hidden "+"initialized keydown keypress keyup visible").split(" ").join(".keyboard ");base.$el.removeClass("ui-keyboard-input ui-keyboard-lockedinput ui-keyboard-placeholder "+"ui-keyboard-notallowed ui-keyboard-always-open "+o.css.input).removeAttr("aria-haspopup").removeAttr("role").unbind(unb+".keyboard").removeData("keyboard")};base.init()};$.keyboard.keyaction={accept:function(base){base.close(true);return false},alt:function(base,el){base.altActive=!base.altActive;base.showKeySet(el)},bksp:function(base){base.insertText("bksp")},cancel:function(base){base.close();return false},clear:function(base){base.$preview.val("")},combo:function(base){var c=!base.options.useCombos;base.options.useCombos=c;base.$keyboard.find(".ui-keyboard-combo").toggleClass(base.options.css.buttonAction,c);if(c){base.checkCombos()}return false},dec:function(base){base.insertText(base.decimal?".":",")},"default":function(base,el){base.shiftActive=base.altActive=base.metaActive=false;base.showKeySet(el)},enter:function(base,el,e){var tag=base.el.tagName,o=base.options;if(e.shiftKey){return o.enterNavigation?base.switchInput(!e[o.enterMod],true):base.close(true)}if(o.enterNavigation&&(tag!=="TEXTAREA"||e[o.enterMod])){return base.switchInput(!e[o.enterMod],o.autoAccept?"true":false)}if(tag==="TEXTAREA"&&$(e.target).closest("button").length){base.insertText(" \n")}},lock:function(base,el){base.lastKeyset[0]=base.shiftActive=base.capsLock=!base.capsLock;base.showKeySet(el)},left:function(base){var p=base.$preview.caret();if(p.start-1>=0){base.lastCaret={start:p.start-1,end:p.start-1}}},meta:function(base,el){base.metaActive=$(el).hasClass(base.options.css.buttonAction)?false:true;base.showKeySet(el)},next:function(base){base.switchInput(true,base.options.autoAccept);return false},prev:function(base){base.switchInput(false,base.options.autoAccept);return false},right:function(base){var p=base.$preview.caret();if(p.start+1<=base.$preview.val().length){base.lastCaret={start:p.start+1,end:p.start+1}}},shift:function(base,el){base.lastKeyset[0]=base.shiftActive=!base.shiftActive;base.showKeySet(el)},sign:function(base){if(/^\-?\d*\.?\d*$/.test(base.$preview.val())){base.$preview.val(base.$preview.val()*-1)}},space:function(base){base.insertText(" ")},tab:function(base){var tag=base.el.tagName,o=base.options;if(tag==="INPUT"){if(o.tabNavigation){return base.switchInput(!base.shiftActive,true)}else{return false}}base.insertText("	")}};$.keyboard.layouts={alpha:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ ¡ ² ³ ¤ € ¼ ½ ¾ ‘ ’ ¥ × {bksp}","{tab} ä å é ® þ ü ú í ó ö « » ¬","á ß ð f g h j k ø ¶ ´ {enter}","{shift} æ x © v b ñ µ ç > ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ ¹ ² ³ £ € ¼ ½ ¾ ‘ ’ ¥ ÷ {bksp}","{tab} Ä Å É ® Þ Ü Ú Í Ó Ö « » ¦","Ä § Ð F G H J K Ø ° ¨ {enter}","{shift} Æ X ¢ V B Ñ µ Ç . ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"]},dvorak:{"default":["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{"default":["= ( ) {b}","{clear} / * -","7 8 9 +","4 5 6 {sign}","1 2 3 %","0 . {a} {c}"]}};$.keyboard.defaultOptions={layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},usePreview:true,alwaysOpen:false,initialFocus:true,stayOpen:false,display:{a:"✔:Accept (Shift-Enter)",accept:"Accept:Accept (Shift-Enter)",alt:"Alt:⌥ AltGr",b:"⌫:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"⏎:Enter",empty:" ",enter:"Enter:Enter ⏎",left:"←",lock:"Lock:⇪ Caps Lock",next:"Next ⇨",prev:"⇦ Prev",right:"→",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:"&nbsp;:Space",t:"⇥:Tab",tab:"⇥ Tab:Tab"},wheelMessage:"Use mousewheel to see other keys",css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonDisabled:"ui-state-disabled"},autoAccept:false,lockInput:false,restrictInput:false,acceptValid:false,cancelClose:true,tabNavigation:false,enterNavigation:false,enterMod:"altKey",stopAtEnd:true,appendLocally:false,stickyShift:true,preventPaste:false,caretToEnd:false,maxLength:false,repeatDelay:500,repeatRate:20,resetDefault:false,openOn:"focus",keyBinding:"mousedown touchstart",useCombos:true,combos:{"`":{a:"à",A:"À",e:"è",E:"È",i:"ì",I:"Ì",o:"ò",O:"Ò",u:"ù",U:"Ù",y:"ỳ",Y:"Ỳ"},"'":{a:"á",A:"Á",e:"é",E:"É",i:"í",I:"Í",o:"ó",O:"Ó",u:"ú",U:"Ú",y:"ý",Y:"Ý"},'"':{a:"ä",A:"Ä",e:"ë",E:"Ë",i:"ï",I:"Ï",o:"ö",O:"Ö",u:"ü",U:"Ü",y:"ÿ",Y:"Ÿ"},"^":{a:"â",A:"Â",e:"ê",E:"Ê",i:"î",I:"Î",o:"ô",O:"Ô",u:"û",U:"Û",y:"ŷ",Y:"Ŷ"},"~":{a:"ã",A:"Ã",e:"ẽ",E:"Ẽ",i:"ĩ",I:"Ĩ",o:"õ",O:"Õ",u:"ũ",U:"Ũ",y:"ỹ",Y:"Ỹ",n:"ñ",N:"Ñ"}},validate:function(keyboard,value,isClosing){return true}};$.keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/gim;$.keyboard.currentKeyboard="";$.fn.keyboard=function(options){return this.each(function(){if(!$(this).data("keyboard")){new $.keyboard(this,options)}})};$.fn.getkeyboard=function(){return this.data("keyboard")}})(jQuery);(function($,len,createRange,duplicate){"use strict";$.fn.caret=function(options,opt2){if(typeof this[0]==="undefined"||this.is(":hidden")||this.css("visibility")==="hidden"){return this}var s,start,e,end,selRange,range,stored_range,te,val,selection=document.selection,t=this[0],sTop=t.scrollTop,ss=typeof t.selectionStart!=="undefined";if(typeof options==="number"&&typeof opt2==="number"){start=options;end=opt2}if(typeof start!=="undefined"){if(ss){t.selectionStart=start;t.selectionEnd=end}else{selRange=t.createTextRange();selRange.collapse(true);selRange.moveStart("character",start);selRange.moveEnd("character",end-start);selRange.select()}if(this.is(":visible")||this.css("visibility")!=="hidden"){this.focus()}t.scrollTop=sTop;return this}else{if(ss){s=t.selectionStart;e=t.selectionEnd}else{if(t.tagName==="TEXTAREA"){val=this.val();range=selection[createRange]();stored_range=range[duplicate]();stored_range.moveToElementText(t);stored_range.setEndPoint("EndToEnd",range);s=stored_range.text.replace(/\r/g,"\n")[len];e=s+range.text.replace(/\r/g,"\n")[len]}else{val=this.val().replace(/\r/g,"\n");range=selection[createRange]()[duplicate]();range.moveEnd("character",val[len]);s=range.text===""?val[len]:val.lastIndexOf(range.text);range=selection[createRange]()[duplicate]();range.moveStart("character",-val[len]);e=range.text[len]}}te=(t.value||"").substring(s,e);return{start:s,end:e,text:te,replace:function(st){return t.value.substring(0,s)+st+t.value.substring(e,t.value[len])}}}}})(jQuery,"length","createRange","duplicate");